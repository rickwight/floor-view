<!DOCTYPE html>
<html>
<head>
  <title>floor-view</title>
  <style>

  body {
      background-color: white;
  }

  </style>
</head>
<body>

<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/jquery-1.8.2.js"></script>
<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/jquery.mousewheel.js"></script>
<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/d3.v2.js"></script>
<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/RequestAnimationFrame.js"></script>
<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/three.js"></script>
<script type="text/javascript" src="http://cdn.rawgit.com/rickwight/floor-view/master/js/d3gl.js"></script>

<script type="text/javascript">

function arrToHash(arr) {
  obj = [];
  for (var i = 0; i < arr.length; i++) {
    h = {};
    h['x'] = arr[i][0];
    h['y'] = arr[i][1];
    h['z'] = arr[i][2];
    obj.push(h);
  }
  return obj;
}

function printVerts(verts) {
  for (var i = 0; i < verts.length; i++) {
    console.log(verts[i]);
  }
}

function drawGraph(width, height, points) {
  console.log('draw: ' + width + ' x ' + height);

  var graph = d3.gl.graph()
    .width(width)
    .height(height);

  var pointcloud = graph.points()
    .data(points)
    .size(5)
    .color(function(d, i) {
      if (i > 50000) return 0x995555;
      else return 0x559999;
      //return scaleColor(vIdx);
    });

  var scales = {
    "x": d3.scale.linear().domain([-40, 40]),
    "y": d3.scale.linear().domain([-40, 40]),
    "z": d3.scale.linear().domain([0, 20])
  };

  var axis = graph.axis()
    .data(["x", "y", "z"])
    .scale(function(d) { return scales[d]; })
    .orient(function(d) { return d; })
    .thickness(1)
    .color("#00f");

  var ticks = axis.ticks()
    .count(function(d) {
      if (d=="z") return 1;
      else return 4;
    })
    .font("16px Arial")
    .size(50)
    .resolution(64);

  var label = axis.label()
    .size(100)
    .resolution(128)
    .font("bold 20px Helvetica")
    .color("#00f");

  d3.select("body").selectAll("span").remove();
  d3.select("body").selectAll("span")
    .data(["pointcloud-house"]).enter().append("span")
    .call(graph);
}

function initPoints() {
  var points = [
    [5,5,5],
    [1,5,5],
    [5,1,5],
    [5,5,1]
  ]
  points = arrToHash(points);
  //printVerts(vertices);

  return points;
}

function time_ms() {
  return new Date().getTime();
}

$(document).ready(function(){
  window.points = initPoints()
  drawGraph($(window).width(), $(window).height(), points);
});

$(window).resize(function() {
  // only draw if we stop resizing for a specified period
  clearTimeout(window.timeout_last_resize);
  window.timeout_last_resize = setTimeout(function() {
    drawGraph($(window).width(), $(window).height(), points);
  }, 500);
});

</script>
</body>
</html>
